import Callout from 'nextra-theme-docs/callout'

# Пагинация

<Callout emoji="✅">
  Пожалуйста, обновитесь до последней версии (≥ 0.3.0), чтобы использовать этот API. Предыдущий API <code>useSWRPages</code> является устаревшим.
</Callout>

SWR предоставляет специальный API `useSWRInfinite` для поддержки общепринятых UI шаблонов, таких как **пагинация** и **бесконечная загрузка**.

## Когда использовать `useSWR`

### Пагинация

Для начала, нам может **НЕ** понадобится `useSWRInfinite`, а вместо него использовать просто `useSWR`, если мы создаем что-то вроде этого:

<div className="mt-8" />

<svg viewBox="0 0 769 356" fill="none" className="invert-on-dark">
<path d="M5 0.5H763C765.485 0.5 767.5 2.51472 767.5 5V351C767.5 353.485 765.485 355.5 763 355.5H5.00002C2.51473 355.5 0.5 353.485 0.5 351V5C0.5 2.51472 2.51472 0.5 5 0.5Z" fill="white" stroke="#EEEEEE"/>
<path d="M1 288H769" stroke="#E5E5E5"/>
<path d="M21 26H747V40H21V26Z" fill="#E5E5E5"/>
<path d="M21 70H747V84H21V70Z" fill="#E5E5E5"/>
<path d="M21 114H747V128H21V114Z" fill="#E5E5E5"/>
<path d="M21 158H747V172H21V158Z" fill="#E5E5E5"/>
<path d="M21 202H747V216H21V202Z" fill="#E5E5E5"/>
<path d="M21 246H747V260H21V246Z" fill="#E5E5E5"/>
<rect x="21.5" y="306.5" width="69" height="31" rx="2.5" fill="#FAFAFA" stroke="#D3D3D3"/>
<path d="m35.8736 326.586.767-.767-2.5611-2.552h6.6904v-1.108h-6.6904l2.5611-2.561-.767-.759L32 322.713l3.8736 3.873ZM52.6005 326.531h-1.1309v-3.943h-4.3008v3.943h-1.125V318h1.125v3.668h4.3008V318h1.1309v8.531ZM58.3427 326.531c-.0625-.125-.1133-.347-.1524-.668-.5039.524-1.1054.785-1.8047.785-.625 0-1.1386-.175-1.541-.527-.3984-.355-.5976-.805-.5976-1.348 0-.66.25-1.171.75-1.535.5039-.367 1.2109-.55 2.1211-.55h1.0546v-.499c0-.378-.1132-.679-.3398-.902-.2266-.226-.5605-.34-1.002-.34-.3867 0-.7109.098-.9726.293-.2617.196-.3926.432-.3926.709h-1.0898c0-.316.1113-.621.334-.914.2265-.297.5312-.531.914-.703.3867-.172.8106-.258 1.2715-.258.7305 0 1.3027.184 1.7168.551.4141.363.6289.865.6445 1.506v2.918c0 .582.0742 1.045.2227 1.389v.093h-1.1367Zm-1.7989-.826c.3399 0 .6621-.088.9668-.264.3047-.175.5254-.404.6621-.685v-1.301h-.8496c-1.3281 0-1.9922.389-1.9922 1.166 0 .34.1133.606.3399.797.2266.191.5176.287.873.287ZM64.4423 321.926c0-.297-.1133-.531-.3399-.703-.2265-.176-.5371-.264-.9316-.264-.3828 0-.7031.1-.9609.299-.254.199-.3809.433-.3809.703h-1.0781c0-.551.2304-1.002.6914-1.354.4609-.351 1.0371-.527 1.7285-.527.7422 0 1.3203.16 1.7344.481.414.316.6211.769.6211 1.359 0 .285-.086.547-.2579.785-.1718.238-.416.428-.7324.568.7383.25 1.1074.743 1.1074 1.477 0 .582-.2246 1.043-.6738 1.383-.4492.34-1.0488.51-1.7988.51-.7305 0-1.334-.178-1.8106-.534-.4726-.359-.7089-.843-.7089-1.453h1.0781c0 .309.1367.574.4101.797.2774.219.6211.328 1.0313.328.4141 0 .748-.095 1.0019-.287.2539-.191.3809-.439.3809-.744 0-.355-.1074-.609-.3223-.762-.2109-.156-.541-.234-.9902-.234h-1.084v-.914h1.1778c.7382-.02 1.1074-.324 1.1074-.914ZM70.9638 326.531c-.0625-.125-.1133-.347-.1524-.668-.5039.524-1.1055.785-1.8047.785-.625 0-1.1386-.175-1.541-.527-.3984-.355-.5976-.805-.5976-1.348 0-.66.25-1.171.75-1.535.5039-.367 1.2109-.55 2.121-.55h1.0547v-.499c0-.378-.1132-.679-.3398-.902-.2266-.226-.5606-.34-1.002-.34-.3867 0-.7109.098-.9726.293-.2617.196-.3926.432-.3926.709H66.997c0-.316.1113-.621.3339-.914.2266-.297.5313-.531.9141-.703.3867-.172.8106-.258 1.2715-.258.7305 0 1.3027.184 1.7168.551.4141.363.6289.865.6445 1.506v2.918c0 .582.0742 1.045.2227 1.389v.093h-1.1367Zm-1.7989-.826c.3399 0 .6621-.088.9668-.264.3047-.175.5254-.404.6621-.685v-1.301h-.8496c-1.3281 0-1.9922.389-1.9922 1.166 0 .34.1133.606.3399.797.2265.191.5176.287.873.287ZM73.5243 325.646l.375-.462c.4219-.547.6621-1.368.7207-2.461l.0996-2.532h4.084v5.455h.8145v2.749h-1.084v-1.864h-4.4239v1.864h-1.0839l.0058-2.749h.4922Zm1.2832 0h2.9121v-4.453h-1.9512l-.0644 1.512c-.0664 1.262-.3652 2.242-.8965 2.941Z" fill="#454545"/>
<rect x="307.5" y="306.5" width="69" height="31" rx="2.5" fill="#FAFAFA" stroke="#D3D3D3"/>
<path d="m364.734 326.709 3.874-3.873-3.874-3.874-.767.767 2.561 2.553h-6.69v1.108h6.69l-2.561 2.557.767.762ZM315 326.654v-8.531h2.789c.926 0 1.621.191 2.086.574.469.383.703.949.703 1.699 0 .399-.113.752-.34 1.061-.226.305-.535.541-.926.709.461.129.825.375 1.09.738.27.36.405.789.405 1.289 0 .766-.248 1.368-.745 1.805-.496.438-1.197.656-2.103.656H315Zm1.125-3.99v3.07h1.857c.524 0 .936-.134 1.237-.404.304-.273.457-.648.457-1.125 0-1.027-.559-1.541-1.676-1.541h-1.875Zm0-.902h1.699c.492 0 .885-.123 1.178-.369.297-.247.445-.581.445-1.002 0-.469-.136-.809-.41-1.02-.273-.215-.689-.322-1.248-.322h-1.664v2.713ZM327.492 326.654h-1.084v-5.443h-2.918v5.443h-1.09v-6.34h5.092v6.34ZM331.863 326.771c-.859 0-1.558-.281-2.097-.843-.539-.567-.809-1.323-.809-2.268v-.199c0-.629.119-1.19.357-1.682.243-.496.579-.883 1.008-1.16.434-.281.903-.422 1.407-.422.824 0 1.464.272 1.921.815.457.543.686 1.32.686 2.332v.451h-4.295c.016.625.197 1.131.545 1.517.352.383.797.575 1.336.575.383 0 .707-.078.973-.235.265-.156.498-.363.697-.621l.662.516c-.531.816-1.328 1.224-2.391 1.224Zm-.134-5.683c-.438 0-.805.16-1.102.48-.297.317-.481.762-.551 1.336h3.176v-.082c-.031-.551-.18-.976-.445-1.277-.266-.305-.625-.457-1.078-.457ZM340.951 323.555c0 .965-.221 1.742-.662 2.332-.441.59-1.039.884-1.793.884-.769 0-1.375-.244-1.816-.732v3.053h-1.084v-8.778h.99l.053.704c.441-.547 1.054-.821 1.84-.821.761 0 1.363.287 1.804.862.446.574.668 1.373.668 2.396v.1Zm-1.084-.123c0-.715-.152-1.28-.457-1.694-.305-.414-.722-.621-1.254-.621-.656 0-1.148.291-1.476.873v3.03c.324.578.82.867 1.488.867.52 0 .932-.205 1.236-.616.309-.414.463-1.027.463-1.839ZM344.965 326.771c-.86 0-1.559-.281-2.098-.843-.539-.567-.808-1.323-.808-2.268v-.199c0-.629.119-1.19.357-1.682.242-.496.578-.883 1.008-1.16.433-.281.902-.422 1.406-.422.824 0 1.465.272 1.922.815.457.543.686 1.32.686 2.332v.451h-4.295c.015.625.197 1.131.545 1.517.351.383.796.575 1.335.575.383 0 .707-.078.973-.235.266-.156.498-.363.697-.621l.662.516c-.531.816-1.328 1.224-2.39 1.224Zm-.135-5.683c-.437 0-.805.16-1.101.48-.297.317-.481.762-.551 1.336h3.176v-.082c-.032-.551-.18-.976-.446-1.277-.265-.305-.625-.457-1.078-.457Zm-1.892-2.467c0-.176.052-.322.158-.439.109-.121.269-.182.48-.182.211 0 .371.061.481.182.109.117.164.263.164.439s-.055.322-.164.44c-.11.117-.27.175-.481.175-.211 0-.371-.058-.48-.175-.106-.118-.158-.264-.158-.44Zm2.519.012c0-.176.053-.324.158-.445.11-.122.27-.182.481-.182.211 0 .371.06.48.182.11.121.164.269.164.445s-.054.322-.164.439c-.109.117-.269.176-.48.176-.211 0-.371-.059-.481-.176-.105-.117-.158-.263-.158-.439ZM348.645 325.77l.375-.463c.421-.547.662-1.368.72-2.461l.1-2.532h4.084v5.456h.814v2.748h-1.084v-1.864h-4.424v1.864h-1.084l.006-2.748h.493Zm1.283 0h2.912v-4.454h-1.951l-.065 1.512c-.066 1.262-.365 2.242-.896 2.942Z" fill="#454545"/>
<path d="M281.098 322.03C281.563 322.03 281.951 321.651 281.951 321.178C281.951 320.713 281.563 320.33 281.098 320.33C280.63 320.33 280.246 320.713 280.246 321.178C280.246 321.651 280.63 322.03 281.098 322.03ZM284.497 322.03C284.961 322.03 285.349 321.651 285.349 321.178C285.349 320.713 284.961 320.33 284.497 320.33C284.028 320.33 283.645 320.713 283.645 321.178C283.645 321.651 284.028 322.03 284.497 322.03ZM287.895 322.03C288.36 322.03 288.748 321.651 288.748 321.178C288.748 320.713 288.36 320.33 287.895 320.33C287.426 320.33 287.043 320.713 287.043 321.178C287.043 321.651 287.426 322.03 287.895 322.03Z" fill="black"/>
<rect x="103.5" y="306.5" width="44" height="31" rx="2.5" fill="#FAFAFA" stroke="#D3D3D3"/>
<path d="M126.653 318.273H125.37L123.193 319.696V320.957L125.281 319.594H125.332V327H126.653V318.273Z" fill="#454545"/>
<rect x="160.5" y="306.5" width="44" height="31" rx="2.5" fill="#EDEDED" stroke="#B3B3B3"/>
<path d="M179.498 327H185.242V325.871H181.313V325.807L183.048 323.991C184.646 322.376 185.102 321.605 185.102 320.629C185.102 319.227 183.96 318.153 182.315 318.153C180.683 318.153 179.489 319.21 179.489 320.804H180.746C180.742 319.866 181.347 319.253 182.289 319.253C183.175 319.253 183.849 319.798 183.849 320.668C183.849 321.439 183.389 321.993 182.451 322.986L179.498 326.045V327Z" fill="#454545"/>
<rect x="217.5" y="306.5" width="44" height="31" rx="2.5" fill="#FAFAFA" stroke="#D3D3D3"/>
<path d="M239.349 327.119C241.13 327.119 242.438 326.054 242.434 324.605C242.438 323.501 241.769 322.709 240.61 322.53V322.462C241.522 322.227 242.114 321.511 242.11 320.531C242.114 319.249 241.062 318.153 239.383 318.153C237.781 318.153 236.494 319.121 236.451 320.54H237.725C237.755 319.739 238.509 319.253 239.366 319.253C240.256 319.253 240.84 319.794 240.836 320.599C240.84 321.443 240.163 321.997 239.195 321.997H238.458V323.071H239.195C240.406 323.071 241.104 323.685 241.104 324.562C241.104 325.411 240.367 325.986 239.34 325.986C238.394 325.986 237.657 325.5 237.606 324.724H236.268C236.323 326.148 237.585 327.119 239.349 327.119Z" fill="#454545"/>
</svg>

...что является типичной UI пагинацией. Посмотрим, как это легко реализовать с помощью `useSWR`:

```jsx highlight=5
function App () {
  const [pageIndex, setPageIndex] = useState(0);

  // URL-адрес API включает индекс страницы, который является состоянием React.
  const { data } = useSWR(`/api/data?page=${pageIndex}`, fetcher);

  // ... обработка состояния загразки и ошибки

  return <div>
    {data.map(item => <div key={item.id}>{item.name}</div>)}
    <button onClick={() => setPageIndex(pageIndex - 1)}>Назад</button>
    <button onClick={() => setPageIndex(pageIndex + 1)}>Вперёд</button>
  </div>
}
```

Более того, мы можем создать абстракцию для этого «компонента страницы»:

```jsx highlight=13
function Page ({ index }) {
  const { data } = useSWR(`/api/data?page=${index}`, fetcher);

  // ... обработка состояния загразки и ошибки

  return data.map(item => <div key={item.id}>{item.name}</div>)
}

function App () {
  const [pageIndex, setPageIndex] = useState(0);

  return <div>
    <Page index={pageIndex}/>
    <button onClick={() => setPageIndex(pageIndex - 1)}>Назад</button>
    <button onClick={() => setPageIndex(pageIndex + 1)}>Вперёд</button>
  </div>
}
```

Благодаря кешу SWR мы получаем возможность предварительно загрузить следующую страницу.
Мы рендерим следующую страницу внутри скрытого div, поэтому SWR будет запускать выборку данных следующей страницы.
Когда пользователь переходит на следующую страницу, данные уже там:

```jsx highlight=6
function App () {
  const [pageIndex, setPageIndex] = useState(0);

  return <div>
    <Page index={pageIndex}/>
    <div style={{ display: 'none' }}><Page index={pageIndex + 1}/></div>
    <button onClick={() => setPageIndex(pageIndex - 1)}>Назад</button>
    <button onClick={() => setPageIndex(pageIndex + 1)}>Вперёд</button>
  </div>
}
```

Всего с одной строкой кода мы получаем улучшенный UX. Хук `useSWR` настолько мощный,
что он покрывает большинство сценариев.

### Бесконечная загрузка

Иногда мы хотим создать интерфейс **бесконечной загрузки** с кнопкой «Загрузить ещё»,
которая добавляет данные в список (или делает это автоматически при прокрутке):

<div className="mt-8" />

<svg viewBox="0 0 769 356" fill="none" className="invert-on-dark">
<path d="M5 0.5H763C765.485 0.5 767.5 2.51472 767.5 5V351C767.5 353.485 765.485 355.5 763 355.5H5.00002C2.51473 355.5 0.5 353.485 0.5 351V5C0.5 2.51472 2.51472 0.5 5 0.5Z" fill="white" stroke="#EEEEEE"/>
<path d="M21 26H747V40H21V26Z" fill="#E5E5E5"/>
<path d="M21 70H747V84H21V70Z" fill="#E5E5E5"/>
<path d="M21 114H747V128H21V114Z" fill="#E5E5E5"/>
<path d="M21 158H747V172H21V158Z" fill="#E5E5E5"/>
<path d="M21 202H747V216H21V202Z" fill="#E5E5E5"/>
<path d="M21 246H747V260H21V246Z" fill="#E5E5E5"/>
<rect x="21.5" y="288.5" width="725" height="31" rx="2.5" fill="#FAFAFA" stroke="#D3D3D3"/>
<path d="M348.367 302.76c0-.453-.166-.813-.498-1.078-.328-.27-.791-.405-1.389-.405-.5 0-.919.139-1.259.416-.336.274-.504.614-.504 1.02h-1.125c0-.453.123-.859.369-1.219.25-.359.598-.639 1.043-.838.445-.203.937-.304 1.476-.304.954 0 1.694.214 2.221.644.528.426.791 1.02.791 1.781 0 .395-.121.754-.363 1.078-.242.325-.58.581-1.014.768 1.004.336 1.506 1.002 1.506 1.998 0 .766-.285 1.373-.855 1.822-.571.45-1.332.674-2.286.674-.566 0-1.082-.099-1.546-.299-.461-.203-.821-.49-1.079-.861-.257-.371-.386-.812-.386-1.324h1.125c0 .449.177.824.533 1.125.355.297.807.445 1.353.445.614 0 1.102-.142 1.465-.428.367-.285.551-.662.551-1.13 0-1-.619-1.51-1.857-1.53h-1.055v-.926h1.049c.57-.011 1.002-.14 1.295-.386.293-.246.439-.594.439-1.043ZM354.859 309c-.062-.125-.113-.348-.152-.668-.504.523-1.105.785-1.805.785-.625 0-1.138-.176-1.541-.527-.398-.356-.597-.805-.597-1.348 0-.66.25-1.172.75-1.535.504-.367 1.211-.551 2.121-.551h1.054v-.498c0-.379-.113-.679-.339-.902-.227-.227-.561-.34-1.002-.34-.387 0-.711.098-.973.293-.262.195-.393.432-.393.709h-1.089c0-.316.111-.621.334-.914.226-.297.531-.531.914-.703.386-.172.81-.258 1.271-.258.731 0 1.303.184 1.717.551.414.363.629.865.644 1.506v2.918c0 .582.075 1.044.223 1.388V309h-1.137Zm-1.798-.826c.339 0 .662-.088.966-.264.305-.176.526-.404.662-.685v-1.301h-.849c-1.328 0-1.992.388-1.992 1.166 0 .34.113.605.34.797.226.191.517.287.873.287ZM361.568 303.557h-2.923V309h-1.09v-6.34h4.013v.897ZM367.867 305.9c0 .965-.221 1.743-.662 2.332-.441.59-1.039.885-1.793.885-.769 0-1.375-.244-1.816-.732v3.053h-1.084v-8.778h.99l.053.703c.441-.547 1.054-.82 1.84-.82.761 0 1.363.287 1.804.861.446.575.668 1.373.668 2.397v.099Zm-1.084-.123c0-.715-.152-1.279-.457-1.693-.305-.414-.722-.621-1.254-.621-.656 0-1.148.291-1.476.873v3.029c.324.578.82.867 1.488.867.52 0 .932-.205 1.236-.615.309-.414.463-1.027.463-1.84ZM371.254 307.412l1.476-4.752h1.161l-2.549 7.319c-.395 1.054-1.022 1.582-1.881 1.582l-.205-.018-.404-.076v-.879l.293.023c.367 0 .652-.074.855-.222.207-.149.377-.42.51-.815l.24-.644-2.262-6.27h1.184l1.582 4.752ZM378.35 304.395c0-.297-.114-.532-.34-.704-.227-.175-.537-.263-.932-.263-.383 0-.703.099-.961.299-.254.199-.381.433-.381.703h-1.078c0-.551.231-1.002.692-1.354.461-.351 1.037-.527 1.728-.527.742 0 1.32.16 1.734.48.415.317.622.77.622 1.36 0 .285-.086.547-.258.785-.172.238-.416.428-.733.568.739.25 1.108.742 1.108 1.477 0 .582-.225 1.043-.674 1.383-.449.339-1.049.509-1.799.509-.73 0-1.334-.177-1.81-.533-.473-.359-.709-.844-.709-1.453h1.078c0 .309.136.574.41.797.277.219.621.328 1.031.328.414 0 .748-.096 1.002-.287.254-.192.381-.44.381-.744 0-.356-.107-.61-.322-.762-.211-.156-.541-.234-.991-.234h-1.084v-.914h1.178c.738-.02 1.108-.325 1.108-.914ZM385.059 302.66h1.084V309h-1.084v-4.623L382.135 309h-1.084v-6.34h1.084v4.629l2.924-4.629ZM392.594 303.539h-2.127V309h-1.084v-5.461h-2.086v-.879h5.297v.879ZM394.832 304.846h1.647c.718.008 1.287.195 1.705.562.418.367.627.865.627 1.494 0 .633-.215 1.141-.645 1.524-.43.383-1.008.574-1.734.574h-2.684v-6.34h1.084v2.186Zm0 .884v2.385h1.611c.407 0 .721-.103.944-.31.222-.211.334-.498.334-.862 0-.351-.11-.638-.328-.861-.215-.227-.518-.344-.909-.352h-1.652ZM405.771 309.117c-.859 0-1.558-.281-2.097-.844-.539-.566-.809-1.322-.809-2.267v-.199c0-.629.119-1.19.358-1.682.242-.496.578-.883 1.007-1.16.434-.281.903-.422 1.407-.422.824 0 1.465.271 1.922.814.457.543.685 1.321.685 2.332v.452h-4.295c.016.625.197 1.13.545 1.517.352.383.797.574 1.336.574.383 0 .707-.078.973-.234.265-.156.498-.363.697-.621l.662.516c-.531.816-1.328 1.224-2.391 1.224Zm-.134-5.683c-.438 0-.805.16-1.102.48-.297.316-.48.762-.551 1.336h3.176v-.082c-.031-.551-.18-.977-.445-1.277-.266-.305-.625-.457-1.078-.457ZM410.623 302.66v5.455h2.32v-5.455h1.084v5.455h2.315v-5.455h1.09v5.455h.89l-.105 2.766h-.973V309h-7.711v-6.34h1.09ZM422.131 309.117c-.86 0-1.559-.281-2.098-.844-.539-.566-.808-1.322-.808-2.267v-.199c0-.629.119-1.19.357-1.682.242-.496.578-.883 1.008-1.16.433-.281.902-.422 1.406-.422.824 0 1.465.271 1.922.814.457.543.686 1.321.686 2.332v.452h-4.295c.015.625.197 1.13.545 1.517.351.383.796.574 1.335.574.383 0 .707-.078.973-.234.266-.156.498-.363.697-.621l.662.516c-.531.816-1.328 1.224-2.39 1.224Zm-.135-5.683c-.437 0-.805.16-1.101.48-.297.316-.481.762-.551 1.336h3.176v-.082c-.032-.551-.18-.977-.446-1.277-.265-.305-.625-.457-1.078-.457Zm-1.892-2.467c0-.176.052-.322.158-.44.109-.121.269-.181.48-.181.211 0 .371.06.481.181.109.118.164.264.164.44s-.055.322-.164.439c-.11.117-.27.176-.481.176-.211 0-.371-.059-.48-.176-.106-.117-.158-.263-.158-.439Zm2.519.012c0-.176.053-.325.158-.446.11-.121.27-.181.481-.181.211 0 .371.06.48.181.11.121.164.27.164.446 0 .175-.054.322-.164.439-.109.117-.269.176-.48.176-.211 0-.371-.059-.481-.176-.105-.117-.158-.264-.158-.439Z" fill="#454545"/>
</svg>

Чтобы реализовать это, нам нужно сделать **динамическое количество запросов** на этой странице.
У хуков React есть [пара правил](https://ru.reactjs.org/docs/hooks-rules.html), поэтому мы **НЕ МОЖЕМ** делать что-то вроде этого:

```jsx highlight=5,6,7,8,9
function App () {
  const [cnt, setCnt] = useState(1)

  const list = []
  for (let i = 0; i < cnt; i++) {
    // 🚨 Это не правильно! Как правило, вы не можете использовать хуки внутри цикла.
    const { data } = useSWR(`/api/data?page=${i}`)
    list.push(data)
  }

  return <div>
    {list.map((data, i) =>
      <div key={i}>{
        data.map(item => <div key={item.id}>{item.name}</div>)
      }</div>)}
    <button onClick={() => setCnt(cnt + 1)}>Загрузить ещё</button>
  </div>
}
```

Вместо этого мы можем использовать абстракцию `<Page />`, которую мы создали для этого:

```jsx highlight=5,6,7
function App () {
  const [cnt, setCnt] = useState(1)

  const pages = []
  for (let i = 0; i < cnt; i++) {
    pages.push(<Page index={i} key={i} />)
  }

  return <div>
    {pages}
    <button onClick={() => setCnt(cnt + 1)}>Загрузить ещё</button>
  </div>
}
```

### Продвинутые случаи

Однако, в некоторых продвинутых случаях, приведенное выше решение не работает.

Например, мы всё ещё реализуем тот же UI «Загрузить ещё», но нам также необходимо отображать число,
показывающее, сколько всего элементов имеется. Мы больше не можем использовать решение `<Page />`,
потому что UI верхнего уровня (`<App />`) нужны данные внутри каждой страницы:

```jsx highlight=10
function App () {
  const [cnt, setCnt] = useState(1)

  const pages = []
  for (let i = 0; i < cnt; i++) {
    pages.push(<Page index={i} key={i} />)
  }

  return <div>
    <p>??? элементов</p>
    {pages}
    <button onClick={() => setCnt(cnt + 1)}>Загрузить ещё</button>
  </div>
}
```

Кроме того, если используется API пагинации **на основе курсора**, это решение тоже не работает.
Из-за того, что каждой странице нужны данные с предыдущей страницы, они не изолированы.

Решить эту задачу нам может помочь новый хук `useSWRInfinite`.

## useSWRInfinite

`useSWRInfinite` дает нам возможность запускать несколько запросов с помощью одного хука. Вот как это выглядит:

```jsx
import useSWRInfinite from 'swr/infinite'

// ...
const { data, error, isValidating, mutate, size, setSize } = useSWRInfinite(
  getKey, fetcher?, options?
)
```

Подобно `useSWR`, этот новый хук принимает функцию, которая возвращает ключ запроса, функцию fetcher и опции.
Он возвращает все значения, что и `useSWR`, включая 2 дополнительных значения: размер страницы и установщик размера страницы, как состояние React.

При бесконечной загрузке одна _страница_ — это один запрос, и наша цель — получить несколько страниц и отобразить их.

<Callout emoji="⚠️">
  Если вы используете версии SWR 0.x, `useSWRInfinite` необходимо импортировать из `swr`:<br/>
  `import { useSWRInfinite } from 'swr'`
</Callout>

### API

#### Параметры

- `getKey`: функция, которая принимает индекс и данные предыдущей страницы, возвращает ключ страницы
- `fetcher`: то же, что и [fetcher-функция](/docs/data-fetching) `useSWR`
- `options`: принимает все опции, которые поддерживает `useSWR`, с 3 дополнительными опциями:
  - `initialSize = 1`: количество страниц, которые должны быть загружены изначально
  - `revalidateAll = false`: всегда пытаться ревалидировать все страницы
  - `persistSize = false`: не сбрасывать размер страницы до 1 (или `initialSize`, если установлен), когда ключ первой страницы изменяется

<Callout>
  Обратите внимание, что опцию `initialSize` нельзя изменять в жизненном цикле.
</Callout>

#### Возвращаемые значения

- `data`: массив значений ответа выборки каждой страницы
- `error`: то же , что и `error` в `useSWR`
- `isValidating`: то же, что и `isValidating` в `useSWR`
- `mutate`: то же, что и связанная функция мутации в `useSWR`, но манипулирует массивом данных
- `size`: количество страниц, которые _будут_ извлекаться и возвращаться
- `setSize`: установить количество страниц, которые необходимо извлечь

### Пример 1: API пагинации на основе индекса

Для обычных API на основе индекса:

```plaintext
GET /users?page=0&limit=10
[
  { name: 'Алиса', ... },
  { name: 'Вася', ... },
  { name: 'Катя', ... },
  ...
]
```

```jsx highlight=4,5,6,7,10
// Функция для получения ключа SWR каждой страницы,
// её возвращаемое значение будет принято в `fetcher`.
// Если возвращается `null`, запрос этой страницы не запускается.
const getKey = (pageIndex, previousPageData) => {
  if (previousPageData && !previousPageData.length) return null // достигнут конец
  return `/users?page=${pageIndex}&limit=10`                    // ключ SWR
}

function App () {
  const { data, size, setSize } = useSWRInfinite(getKey, fetcher)
  if (!data) return 'loading'

  // Теперь мы можем подсчитать количество всех пользователей
  let totalUsers = 0
  for (let i = 0; i < data.length; i++) {
    totalUsers += data[i].length
  }

  return <div>
    <p>{totalUsers} users listed</p>
    {data.map((users, index) => {
      // `data` — это массив ответов API каждой страницы.
      return users.map(user => <div key={user.id}>{user.name}</div>)
    })}
    <button onClick={() => setSize(size + 1)}>Загрузить ещё</button>
  </div>
}
```

Функция `getKey` является основным отличием `useSWRInfinite` от `useSWR`.
Она принимает индекс текущей страницы, а также данные с предыдущей страницы.
Таким образом, оба API пагинации: на основе индекса, и на основе курсора хорошо поддерживаются.

Кроме того, `data` больше не является одним ответом API. Это массив из нескольких ответов API:

```js
// `data` будет выглядеть вот так:
[
  [
    { name: 'Алиса', ... },
    { name: 'Вася', ... },
    { name: 'Катя', ... },
    ...
  ],
  [
    { name: 'Иван', ... },
    { name: 'Павел', ... },
    { name: 'Георгий', ... },
    ...
  ],
  ...
]
```

### Пример 2: API пагинации на основе курсора или смещения

Допустим, API теперь требует курсор и возвращает следующий курсор вместе с данными:

```plaintext
GET /users?cursor=123&limit=10
{
  data: [
    { name: 'Алиса' },
    { name: 'Вася' },
    { name: 'Катя' },
    ...
  ],
  nextCursor: 456
}
```

Мы можем изменить нашу функцию `getKey` на:

```jsx
const getKey = (pageIndex, previousPageData) => {
  // достигнут конец
  if (previousPageData && !previousPageData.data) return null

  // первая страница, у нас нет `previousPageData`
  if (pageIndex === 0) return `/users?limit=10`

  // добавим курсор в endpoint API
  return `/users?cursor=${previousPageData.nextCursor}&limit=10`
}
```

### Расширенные возможности

[Вот пример](/examples/infinite-loading), показывающий, как вы можете реализовать следующий функционал с помощью `useSWRInfinite`:

- состояния загрузки
- показ специального интерфейса, если он пуст
- отключение кнопки «Загрузить ещё», если достигнут конец
- изменяемый источник данных
- обновление всего списка
